## MLFQ(Multi-level Feedback Queue)

스케줄링 기법은 작업의 특성에 대한 정보 없이 스케쥴링을 최적화 하는 기법이다.

바로 작업의 실행을 관찰한 후 그에 따라 우선순위를 지정한다.

MLFQ를 통해서 짧은 작업을 먼저 실행시켜 반환 시간을 최적화하고 대화형 사용자에게 빠르게 응답하고자 하는 것을 목표로 했다.

### 규칙 5가지

1. Priority(A) > Priority(B) 이면, A가 실행된다 (B는 실행되지 않는다).
2. Priority(A) = Priority(B) 이면, A와 B는 RR 방식으로 실행된다.
3. 작업이 시스템에 진입하면 맨 위의 큐(가장 높은 우선순위)에 놓인다.
4. 주어진 단계에서 시간 할당량을 소진하면 (CPU를 몇 번 양도하였는지 상관없이), 우선순위는 낮아진다 (즉, 아래 단계의 큐로 이동한다).
5. 일정 시간 S가 지나면, 시스템의 모든 작업을 최상위 큐로 이동시킨다.

---

### 규칙에 대하여

큐가 여러 개 있고 각 큐는 우선순위를 가진다. 스케줄러는 작업이 짧은 작업인지 긴 작업인지 알 수 없기 때문에 일단 짧은 작업이라고 가정하여 높은 우선순위를 부여한다. 큐에 있는 여러 프로세스는 같은 우선순위를 가지고, RR 스케줄링 알고리즘을 사용한다. 그리고 MLFQ는 특정 시간이 지나면 작업의 우선순위를 내린다. 진짜 짧은 작업이면 빨리 실행되고 종료될 것이기 때문이다.

그러나 MLFQ의 문제점은 기아 상태가 발생할 수 있다. 우선순위가 한 번 내려가서 올라오지 못하고 너무 많은 대화형 작업이 존재한다면 CPU를 이 대화형이 모두 소모할 것이기 때문이다. 또한 타임 슬라이스가 끝나기 전에 CPU를 양도하면 우선순위를 유지할 수 있다. 

따라서 일정 시간이 지나면 시스템의 모든 작업을 다시 최상위 큐로 옮긴다. 이러면 프로세스는 굶어 죽지 않는다는 것을 보장받는다. 또한 CPU 위주의 작업이 대화형 작업으로 특성이 변할 경우 우선순위 상향을 통해 스케줄러가 변경된 특성에 적합한 스케줄링 방법을 적용한다.

### 정해야 하는 값들

그렇다면 일정 시간은 얼마노 정해야 할까? John Ousterhouts는 이러한 종류의 값을 부두 상수라고 불렀다. 이외에도 큐의 개수, 타임 슬라이스의 크기, 우선순위의 상향 조정의 빈도 등을 결정해야 한지만 사실 워크로드에 대해 충분히 경험하고 계속 조정해 나가야 한다.

### 실제 스케줄러는

대부분의 MLFQ 기법들은 우선순위가 높은 큐일수록 짧은 타임 슬라이스, 낮은 우선순위는 긴 타임 슬라이스를 갖는다. 또한 수학 공식을 사용해 우선순위를 조정한다.(피드백이 조정 = 과거의 행동이 우선순위의 지침이 된다) 그 예시로 FreeBSD의 스케쥴러는 작업의 현재 우선순위를 계산하기 위해 프로세스가 사용한 CPU 시간을 기초로 한 공식을 사용한다.

그리고 일부 스케줄러의 경우 가장 높은 우선순위를 운영체제 작업에 예약을 해둔다.

## 질문

대화형 / CPU 위주 작업 - 차이

타임 슬라이스가 끝나기 직전에 입출력 명령어을 내릴 수 있어서 CPU 시간을 독점할 수 있다. 

## 참고

https://www.youtube.com/watch?v=WOOzgCt6dW4

https://www.youtube.com/watch?v=J0lRlQrtOIA
