# 6장 리액트 개발 도구로 디버깅하기

## 6.3 리액트 개발 도구 활용하기

리액트로 만들어진 웹 사이트에서 `component`와 `profile`이 추가되어 컴포넌트 트리와 렌더링 횟수 등 내부 작동 방식과 성능 측정을 알 수 있다.

### 6.3.1 컴포넌트

**컴포넌트 트리**

`components` 탭에서 리액트 어플리케이션의 컴포넌트 트리를 확인할 수 있고, props와 hook 등 다양한 정보를 파악할 수 있다.

- 익명 함수를 default로 export한 경우 함수 명칭 추론이 불가능하므로 `_default`로 표시된다.

- 익명함수를 `memo`로 감싼 경우에도 함수명을 명확하게 추론하지 못 하기 때문에 `Anonymous`로 표시된다.

기명함수로 컴포넌트를 작성한다면 디버깅하기 훨씬 수월할 것이다.

만약 기명함수로 바꾸기 어렵다면 컴포넌트의 `displayName` 속성을 추가하여 표기할 수 있는 방법도 있다.

```javascript
const MemoizedComponent = memo(function () {
  return <>MemoizedComponent</>;
});

MemoizedComponent.displayName = "MemoComponent";
```

**컴포넌트명과 props**

컴포넌트에 대한 자세한 설명

컴포넌트의 props와 key, 컴포넌트명을 보여준다.

- 빨간색 삼각형 경고문구가 있는 것은 `strict mode`로 렌더링되지 않았다는 것을 의미한다.

- 눈 모양은 해당 컴포넌트가 HTML 어디에서 렌더링됐는지 확인할 수 있다.

- 벌레 아이콘을 누르면 해당 컴포넌트에 대한 정보가 콘솔창에 출력된다.

**컴포넌트 hooks**

`use`가 생략된 이름으로 보여진다

커스텀 훅도 `use`가 생략된 이름으로 표시된다.

**컴포넌트를 렌더링한 주체 rendered by**

프로덕션 모드에서는 `react-dom`의 버전, 개발 모드에서는 부모 컴포넌트도 표시된다.

### 6.3.2 프로파일러

리액트가 렌더링하는 과정에서 발생하는 상황을 확인하기 위한 도구.

프로덕션 환경에서는 활용할 수 없다.

- Debugging 탭의 `Hide logs during second render in Strict Mode`는 `strict mode`에서 useEffect가 2번 실행되어 console.log가 2번 찍히는 것을 막아주는 역할을 한다.

- Profiler 탭의 `Record why each component rendered while profiling`은 프로파일링 도중 무엇 때문에 컴포넌트가 렌더링됐는지 기록한다. 애플리케이션 속도는 조금 느려질 수 있지만 디버깅에 도움을 준다.

**프로파일링**

- `Start Profiling` - 버튼을 누르는 순간 프로파일링이 진행되고 다시 누르면 종료된다.

- `Reload and Start Profiling` - 마찬가지로 프로파일링이 진행되지만 시작하면서 새로고침을 한다.

- `Stop Profiling` - 프로파일링된 현재 내용 제거

- `Load / Save Profile` - 프로파일 불러오기 혹은 저장, JSON 형태의 파일이 다운로드된다.

**Flamegraph**

직관적으로 어떤 컴포넌트가 렌더링이 오래 걸렸는지 확인 할 수 있다.

렌더링하는데 걸린 시간과 렌더링이 발생한 횟수 또한 파악할 수 있다.

**Timeline**

시간이 지남에 따라 컴포넌트에서 어떤 일이 일어났는지를 확인할 수 있다.

# 7장 크롬 개발자 도구를 활용한 애플리케이션 분석

제대로 디버깅을 하고 싶다면 시크릿 모드에서 개발자 모드를 켜서 확인하는 것을 추천한다. 왜냐하면 브라우저에 설치된 각종 확장 프로그램들이 디버깅하는데 방해가 될 수 있기 때문이다.

코드에 의해 클래스나 속성값이 동적으로 제어되는 DOM 요소가 존재한다면 요소의 중단점을 사용해 디버깅할 수 있다.

디버깅하고 싶은 요소를 우클릭 후 `중단 위치`를 선택하고 중단을 원하는 옵션을 클릭해보자. 그러면 관련 작업이 일어날 때 브라우저는 렌더링을 중단하고 해당 요소 변경을 일으킨 소스코드를 보여준다.

## 7.3 소스 탭

소스 탭에서 웹 어플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일을 확인할 수 있다.

앞서 DOM 중단점을 만든 것처럼 소스 중단점을 생성하고 해당 코드에 실행될 때 렌더링을 중단시킬 수 있다.

- 감시 : 개발자가 감시하고 싶은 변수를 선언하고 해당 변수의 정보를 확인할 수 있다.

- 범위 : 현재 중단점에서의 스코프를 알려준다.로컬 / 전역 / 클로저로 나뉘어 확인할 수 있다.

- 호출스택 : 호출 스택에서는 현재 중단점의 콜스택을 확인할 수 있다.

## 7.4 네트워크 탭

네트워크 탭은 페이지에 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록된다.

네트워크 탭을 활용하여 집중적으로 확인해 봐야 하는 점은 다음과 같다.

- 불필요한 요청 또는 중복되는 요청이 없는지

- 웹페이지 구성에 필요한 리소스 크기가 너무 크지 않은지

- 리소스를 불러오는 속도는 적절한지 또는 너무 속도가 오래 걸리는 리소스는 없는지

- 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어가는지

## 7.5 메모리 탭

현재 웹 페이지가 차지하고 있는 메모리 관련 정보를 확인할 수 있다.

어플리케이션에서 발생하는 메모리 누수, 속도 저하, 혹은 웹페이지 프리징 현상을 확인할 수 있는 유용한 도구이다.

메모리 탭은 프로파일링 작업을 거쳐 원하는 정보를 확인할 수 있다.

프로파일링의 유형은 다음과 같이 3가지가 존재한다.

1. 힙 스냅샷 : 현재 메모리 상황을 사진 찍듯 촬영할 수 있다. 현재 시점의 메모리 상황을 알고 싶다면 힙 스냅샷을 이용하자.

2. 타임라인의 할당 계측 : 시간의 흐름에 따른 메모리 변화를 살펴보고 싶다면 타임라인의 할당 계측을 사용하자. 주로 로딩되는 과정에서의 메모리 변화 또는 페이지에서 어떠한 상호작용을 했을 때 메모리의 변화 과정을 알고 싶을 때 사용한다.

3. 할당 샘플링 : 메모리 공간을 차지하고 있는 자바스크립트 함수를 볼 수 있다.

### 7.5.1 자바스크립트 인스턴스 VM 선택

현재 실행 중인 자바스크립트 VM 인스턴스를 확인할 수 있다.

환경 별 힙 크리를 알 수 있는데 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 나타낸다.

### 7.5.2 힙 스냅샷

스냅샷을 찍어 특정 시점에서의 메모리 할당량을 확인할 수 있고 스냅샷 간에서 변화된 메모리도 추적이 가능하다.

_얕은 크기와 유지된 크기_

얕은 크기란 객체 자체가 보유한 메모리의 크기만을 나타내는 것이고,

유지된 크기는 해당 객체 뿐 아니라 참조하고 있는 객체들의 크기까지 합한 것이다.

### 7.5.3 타임라인 할당 계측

시간에 따른 메모리 변화를 모두 기록해둔다. 그래서 살펴보아야할 정보가 많다.

타임라인의 범위를 설정하면서 해당 기간에 할당된 내용만을 확인할 수도 있다.

### 7.5.4 할당 샘플링

할당 샘플리은 시간의 흐름에 따라 발생하는 메모리 점유를 확인할 수 있다는 점에서 타임라인 할당 계측과 비슷하지만 자바스크립트 실행 스택별로 분석할 수 있고, 이 분석을 함수 단위로 한다는 차이점이 있다.

할당 샘플링을 하고 싶은 VM을 선택하고 시작을 누르면 할당 샘플링이 시작된다.

할당 샘플링은 브라우저에 주는 부담을 최소화할 수 있어 장기간 디버깅을 수행해야할 때 유리하다.
