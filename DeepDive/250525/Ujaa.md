# 4.3 Next.js í†ºì•„ë³´ê¸°

## 4.1 Next.js ë€?

Next.jsëŠ” vercelì´ë¼ëŠ” ë¯¸êµ­ ìŠ¤íƒ€íŠ¸ì—…ì—ì„œ ë§Œë“  ë¦¬ì•¡íŠ¸ ê¸°ë°˜ í’€ìŠ¤íƒ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬ë‹¤. SSRë¥¼ ì§€ì›í•˜ëŠ” í”„ë ˆì„ì›Œí¬ ì¤‘ ê°€ì¥ ì‚¬ìš©ìë„ ë§ê³  vercelì˜ ì „í­ì ì¸ ì§€ì›ì„ ë°›ê³  ìˆê¸° ë•Œë¬¸ì— SSRë¥¼ ê³ ë ¤í•˜ê³  ìˆë‹¤ë©´ Next.jsë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ ê°€ì¥ í•©ë¦¬ì ì´ë‹¤.

<aside>
ğŸ‘‰

Next.jsëŠ” ì‚¬ì‹¤ PHPì™€ react-pageì˜ ì˜í–¥ì„ ë°›ì•˜ë‹¤. react-pageëŠ” í˜„ì¬ëŠ” ì¤‘ë‹¨ëœ í˜ì´ìŠ¤ë¶ì—ì„œ ë§Œë“¤ë˜ ë¦¬ì•¡íŠ¸ ê¸°ë°˜ SSR í”„ë¡œì íŠ¸ë¡œ ë””ë ‰í† ë¦¬ ê¸°ë°˜ ë¼ìš°íŒ…ì´ ë°”ë¡œ ì—¬ê¸°ì—ì„œ ì˜í–¥ì„ ë°›ì€ ê²ƒì´ë‹¤.

</aside>

## 4.2 Next.js ì‹œì‘í•˜ê¸°

### ëª…ë ¹ì–´ë¡œ Next.js í”„ë¡œì íŠ¸ ì„¤ì¹˜í•˜ê¸°

```powershell
npx create-next-app@latest
```

### í”„ë¡œì íŠ¸ êµ¬ì¡° ì‚´í”¼ê¸°

```
project-root/
â”œâ”€â”€ src/                     # (ì„ íƒ) source folder
â”‚   â”œâ”€â”€ app/                 # app router
â””â”€â”€ public/                  # static assets
```

**Routing Files**

Next.jsëŠ” íŠ¹ì • íŒŒì¼ ì´ë¦„ì„ ê°€ì§€ë©´(`layout`, `page`, `loading`, `not-found`, `error`, `global-error`, `route`, `template`, `default`) ê·¸ íŒŒì¼ë“¤ì´ ìë™ìœ¼ë¡œ íŠ¹ìˆ˜í•œ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¡œ ë³€í™˜ë˜ë©° ë‹¤ìŒê³¼ ê°™ì€ ì¤‘ì²© ìˆœì„œë¥¼ ê°€ì§„ë‹¤. 

ë˜í•œ, `app/` ë‚´ë¶€ì˜ ìœ„ì¹˜ì— ë”°ë¼ ì¤‘ì²© ë Œë”ë§ëœë‹¤. (ex. `/app/layout.tsx` â†’ `/app/dashboard/layout.tsx` ê°€ ê³„ì¸µì ìœ¼ë¡œ ê°ì‹¸ëŠ” êµ¬ì¡°)

```html
<Layout>
	<Template>
		<ErrorBoundary fallback={<Error />}>
			<Suspense fallback={<Loading/>}>
				<ErrorBoundary fallback={<NotFound/>}>
					<Page/>
				</ErrorBounary>
			</Suspense>
		</ErrorBoundary>
	</Template>
</Layout>
```

**Routes**

| ì¢…ë¥˜ | ì˜ˆì‹œ & ì„¤ëª… |
| --- | --- |
| folder | ê²½ë¡œ |
| folder/folder | ì¤‘ì²© ê²½ë¡œ |
| [folder] | ë™ì  ê²½ë¡œ(/dashboard/1) |
| [â€¦folder] | ë‹¤ì¤‘ í•„ìˆ˜(/doc/a/b/c â†’ slug: [a, b, c]) |
| [[â€¦folder]] | ë‹¤ì¤‘ ì„ íƒ(/doc ë˜ëŠ” /doc/a/b/c â†’ undefined ë˜ëŠ” [a, b, c]) |
| (folder) | ê·¸ë£¹í•‘ |
| _folder | ì™„ì „ ë¬´ì‹œ |
| @folder | ë³‘ë ¬ ë¼ìš°íŒ…í•  ë•Œ ìŠ¬ë¡¯ ì´ë¦„ ì§€ì„ ë•Œ ì‚¬ìš© |
| (.)folder, (..)folder, (â€¦)folder | ì™¼ìª½ë¶€í„° ê°™ì€ ë ˆë²¨, ìƒìœ„, ë£¨íŠ¸ë¥¼ intercept |

### Server Routing vs Client Routing

(ì •ë¦¬ì¤‘)

# 5.1 ìƒíƒœ ê´€ë¦¬ëŠ” ì™œ í•„ìš”í•œê°€?

## ìƒíƒœë€?

ìƒíƒœ? ì–´ë– í•œ ì˜ë¯¸ë¥¼ ì§€ë‹Œ ê°’, ë³€ê²½ë  ìˆ˜ ìˆëŠ” ê°’

ex. UI, URL, form, ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ê°’

<aside>
â“

tearing: í•˜ë‚˜ì˜ ìƒíƒœì— ë”°ë¼ ì„œë¡œ ë‹¤ë¥¸ ê²°ê³¼ë¬¼ì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ëŠ” ê²ƒ

</aside>

## ìƒíƒœ ê´€ë¦¬ ë°©ë²•ë“¤

ë¦¬ì•¡íŠ¸ëŠ” ì²˜ìŒì—ëŠ” ë‹¨ìˆœíˆ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜€ê¸° ë•Œë¬¸ì— ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì´ ì—­ì‚¬ì ìœ¼ë¡œ ê³„ì† ë³€í™”í•´ì™”ë‹¤.

### Flux íŒ¨í„´ ë“±ì¥

2014ë…„ê²½ ë‹¹ì‹œ ì›¹ê°œë°œì€ MVC íŒ¨í„´ì˜ í˜•íƒœë¥¼ ë„ì—ˆëŠ”ë° ë·°ê°€ ëª¨ë¸ì„ ë³€ê²½í•  ìˆ˜ ìˆê³  ëª¨ë¸ì´ ë·°ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì´ë¥¸ë°” ì–‘ë°©í–¥ ë°ì´í„° ë°”ì¸ë”©ì€ ì½”ë“œë¥¼ ê°„ë‹¨íˆ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì´ì ì´ ìˆì§€ë§Œ ë³€ê²½ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë³µì¡í•´ì§€ë©´ ê´€ë¦¬í•˜ê¸° ì–´ë ¤ì›Œì§„ë‹¤. ê·¸ë˜ì„œ ì´ë•Œ í˜ì´ìŠ¤ë¶ íŒ€ì€ ë‹¨ë°©í–¥ ë°ì´í„° íë¦„ì„ ì œì•ˆí•˜ë©° Flux íŒ¨í„´ì„ ì„ ë³´ì´ê¸° ì‹œì‘í–ˆë‹¤.

```html
   Action : ì•¡ì…˜ íƒ€ì…ê³¼ ë°ì´í„°ë¥¼ ì •ì˜í•´ dispatcherë¡œ ë³´ë‚´ëŠ” ì—­í• ì„ í•œë‹¤.
-> Dispatcher : Actionsë¥¼ Storeì— ë³´ë‚´ëŠ” ì—­í• ì„ í•œë‹¤.
-> Store : ìƒíƒœ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì•¡ì…˜ íƒ€ì…ì— ë”°ë¼ ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
-> View : í™”ë©´ì„ ë Œë”ë§í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ë˜í•œ, ë·°ì—ì„œ ì‚¬ìš©ìì˜ ì…ë ¥ì— ë”°ë¼ Actionì„ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.
```

```jsx
type StoreState = {
  count: number
}

type Action = {
 type: 'add',
 payload: number
}

function reducer(prev: StoreState, action: Action) {
  const { type } = action;
  if (type === "add") {
    return { count: prev.count + action.payload }
  }
  throw new Error(`Unexpected Action [${ActionType}]`);
}

export default function App() {
  const [state, dispatcher] = useReducer(reducer, {count: 0})
  
  function handleClick() {
    dispatcher({ type: 'add', payload: 1 })
  }
  
  return (
    <div>
      <h1>{state.count}</h1>
      <button onClick={handleClick}>+</button>
    </div>
  )
}
```

### Redux ë“±ì¥

ë‹¨ë°©í–¥ íë¦„ì€ ë°ì´í„° íë¦„ì„ ì¶”ì í•˜ê¸° ì‰½ë‹¤ëŠ” ëª…í™•í•œ ì´ì ì„ ë³´ì—¬ì¤€ ìƒíƒœì—ì„œ ë™ì‹œì— ìš°í›„ì£½ìˆœì²˜ëŸ¼ ë‹¤ì–‘í•œ Flux íŒ¨í„´ì„ ë”°ë¥´ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìƒê¸°ê¸° ì‹œì‘í–ˆë‹¤. Redux ë˜í•œ ì´ Flux êµ¬ì¡°ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë©°, ReduxëŠ” ê±°ê¸°ì— ë”í•´ íŠ¹ì´í•˜ê²Œ Elmì´ë¼ëŠ” ì•„í‚¤í…ì²˜ì— ì˜í–¥ì„ ë°›ì•˜ë‹¤. ReduxëŠ” í•˜ë‚˜ì˜ ìƒíƒœ ê°ì²´ë¥¼ ìŠ¤í† ì–´ì— ì €ì¥í•˜ê³  ì—…ë°ì´íŠ¸ê°€ ì‹¤í–‰ë˜ë©´ ìƒˆë¡œìš´ ìƒíƒœ ê°ì²´ ë³µì‚¬ë³¸ì„ ë§Œë“¤ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì „íŒŒí•œë‹¤.

<aside>
â“

**Elmì´ë€?**

Elmì€ ì›¹í˜ì´ì§€ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì‘ì„±í•˜ê¸° ìœ„í•œ ì–¸ì–´ë¡œ, Fluxì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë‹¨ë°©í–¥ ë°ì´í„° íë¦„ì„ ê°€ì§„ë‹¤. Elmì€ model, update, viewë¼ëŠ” 3ê°€ì§€ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤.

</aside>

ReduxëŠ” props drilling ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ìƒíƒœì— ë” ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë„ì™”ë‹¤. ContextAPIê°€ ë“±ì¥í•˜ê¸° ì „ê¹Œì§€ ë§ì´ ì‚¬ìš©í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ˆë°˜ì— ë‹¨ì ì€ í•˜ë‚˜ì˜ ìƒíƒœë¥¼ ë°”ê¾¸ê¸° ìœ„í•´ ì‘ì„±í•´ì•¼í•  ì½”ë“œê°€ ë„ˆë¬´ ë§ë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤.

### Context APIì™€ useContext

reduxê°€ ë‚˜ì˜¨ ì´í›„ì—ë„ ë¦¬ì•¡íŠ¸ëŠ” ìƒíƒœë¥¼ ì–´ë–»ê²Œ ì ì ˆíˆ ì£¼ì…í•´ì•¼ í•˜ëŠ”ê°€ ê³„ì†í•´ì„œ ê³ ë¯¼í–ˆë‹¤. reduxë¥¼ ì‚¬ìš©í•˜ë©´ props drilling ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ ë‹¨ìˆœíˆ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒì¸ë°ë„ ë§ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ë¶€ë‹´ìœ¼ë¡œ ë‹¤ê°€ì™”ë‹¤. ê·¸ë˜ì„œ ë¦¬ì•¡íŠ¸ íŒ€ì€ ë¦¬ì•¡íŠ¸ 16.3 ë²„ì „ì—ì„œ ì „ì—­ ìƒíƒœë¥¼ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ì£¼ì…í•  ìˆ˜ ìˆëŠ” ìƒˆë¡œìš´ Context APIë¥¼ ì¶œì‹œí–ˆë‹¤. propsë¡œ ìƒíƒœë¥¼ ë„˜ê²¨ì£¼ì§€ ì•Šì•„ë„ Context APIë¥¼ ì‚¬ìš©í•˜ë©´ ì›í•˜ëŠ” ê³³ì—ì„œ Context Providerê°€ ì£¼ì…í•˜ëŠ” ìƒíƒœë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ëŠ” í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ì— ë§ê²Œ ì‚¬ìš©í•˜ì§€ë§Œ ì²« ë“±ì¥ ë‹¹ì‹œì—ëŠ” í´ë˜ìŠ¤í˜• ì»´í¬ë„ŒíŠ¸ì— ë§ëŠ” í˜•íƒœë¡œ ì‚¬ìš©í–ˆë‹¤.

### í›… íƒ„ìƒ

ë¦¬ì•¡íŠ¸ëŠ” 16.8ë²„ì „ë¶€í„° í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ í›… API(ex. useState)ë¥¼ ì¶”ê°€í–ˆë‹¤. ì´ëŸ° í›…ì˜ ë“±ì¥ìœ¼ë¡œ ìƒˆë¡œìš´ ë°©ì‹ì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë“±ì¥í–ˆìœ¼ë©°, React Queryì™€ SWRì´ ìˆë‹¤. ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë‘ ì™¸ë¶€ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” fetch, íŠ¹íˆ http ìš”ì²­ìœ¼ë¡œ ë°›ì•„ì˜¤ëŠ” ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ”ë° íŠ¹í™”ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.

### Recoil, Zustand, Jotai, Valtio

í›…ì´ë¼ëŠ” ìƒˆë¡œìš´ íŒ¨ëŸ¬ë‹¤ì„ ë“±ì¥ ì´í›„ í›…ì„ í™œìš©í•œ ë²”ìš©ì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ë§ì´ ë“±ì¥í•˜ê¸° ì‹œì‘í–ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì˜ ê³µí†µì ì€ í›…ì„ í™œìš©í•´ ì‘ì€ í¬ê¸°ì˜ ìƒíƒœë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤ëŠ” ê²ƒì´ë‹¤. 

# 5.2 ë¦¬ì•¡íŠ¸ í›…ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìƒíƒœ ê´€ë¦¬

## ë¦¬ì•¡íŠ¸ í›…ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìƒíƒœ ê´€ë¦¬

### useState, useReducer

useStateë¥¼ ì´ìš©í•´ ì§€ì—­ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ì»¤ìŠ¤í…€ í›…ì„ ë§Œë“¤ì–´ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë˜í•œ useStateëŠ” ë‚´ë¶€ì ìœ¼ë¡œ useReducerë¡œ êµ¬í˜„ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— useReducer í›…ì„ ì´ìš©í•  ìˆ˜ë„ ìˆë‹¤.

```jsx
function useCounter(initCount: number = 0) {
  const [counter, setCounter] = useState(initCount);
  
  function inc() {
    setCounter(prev => prev + 1);
  }
  
  return {counter, inc}
}
```

ê·¸ëŸ¬ë‚˜ ì•„ë˜ ì½”ë“œì²˜ëŸ¼ í›…ì„ ì‚¬ìš©í•  ê²½ìš° í›…ì„ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ì»´í¬ë„ŒíŠ¸ë³„ë¡œ ì´ˆê¸°í™”ë˜ê¸° ë•Œë¬¸ì— ê° ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ì§€ì—­ ìƒíƒœë¡œë°–ì— ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

```jsx
function Counter1() {
  const {counter, inc} = useCounter();
  
  return (
	  <>
      <h3>Counter1: {counter}</h3>
      <button onClick={inc}>+</button>
    </>
  )
}

function Counter2() {
  const {counter, inc} = useCounter();
  
  return (
	  <>
      <h3>Counter2: {counter}</h3>
      <button onClick={inc}>+</button>
    </>
  )
}
```

ë‘ ì»´í¬ë„ŒíŠ¸ê°€ ê°™ì€ ìƒíƒœë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ë¶€ëª¨ì—ì„œ ì„ ì–¸í•´ propsë¡œ ìƒíƒœì™€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ ì‚¬ìš©í•˜ê¸° ë¶ˆí¸í•˜ë‹¤.

```jsx
function Parent() {
  const {counter, inc} = useCounter();
  
  return (
    <>
      <Counter1 counter={counter} inc={inc} />
      <Counter2 counter={counter} inc={inc} />
    </>
  )
}
```

### useState ë°”ê¹¥ìœ¼ë¡œ ë¶„ë¦¬í•˜ê¸°

```tsx
export type State = { counter: number }

let state: State = {
  counter: 0
}

export function get(): State {
  return state
}

type Initializer<T> = T extends any ? T | ((prev: T) => T) : never // ë­”ë§ì´ì•¼

export function set<T>(nextState: Initializer<T>) {
  state = typeof nextState == 'function' ? nextState(state) : nextState
}
```

## ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ Recoil, Jotai, Zustand ì‚´í´ë³´ê¸°

Recoilê³¼ JotaiëŠ” Context, Providerê·¸ë¦¬ê³  í›…ì„ ê¸°ë°˜ìœ¼ë¡œ ê°€ëŠ¥í•œ ì‘ì€ ìƒíƒœë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ”ë° ì´ˆì ì„ ë§ì¶”ê³  ìˆë‹¤. ZustandëŠ” ë¦¬ë•ìŠ¤ì™€ ë¹„ìŠ·í•˜ê²Œ í•˜ë‚˜ì˜ í° ìŠ¤í† ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë©° í´ë¡œì € ê¸°ë°˜ì´ë‹¤.

- ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ë¶€ì—ì„œ ì–´ë–»ê²Œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë‹ˆ?
- ìƒíƒœë¥¼ ê° ì»´í¬ë„ŒíŠ¸ë¡œ ì–´ë–»ê²Œ ì „íŒŒí•´ ë Œë”ë§ì„ ì¼ìœ¼í‚¤ë‹ˆ?

### Recoil

í˜ì´ìŠ¤ë¶ì—ì„œ ë§Œë“  ë¦¬ì•¡íŠ¸ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬. í›… ê¸°ë°˜ì´ë‹¤.
